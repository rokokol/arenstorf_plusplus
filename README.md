# Arenstorf++: Моделирование орбитальных задач с адаптивным методом Мерсона

Репозиторий посвящён численному решению задачи движения спутников по орбитам с помощью адаптивного метода Мерсона, оптимизации вычислений и анализу вероятности столкновений.

## Формулировка задачи

Рассматривается следующая система дифференциальных уравнений:

$$
\begin{cases}
x''=x+2y'-M\frac{x+m}{R_{1}}-m \frac{x-M}{R_{2}} \\
y''=y-2x'-M \frac{y}{R_{1}}-m \frac{y}{R_{2}}
\end{cases}
\implies
\begin{cases}
v_{1}'=x+2v_{2}-M\frac{x+m}{R_{1}}-m \frac{x-M}{R_{2}} \\
v_{2}'=y-2v_{1}-M \frac{y}{R_{1}}-m \frac{y}{R_{2}} \\
x'=v_{1} \\
y'=v_{2}
\end{cases}
$$

Начальные условия (Задача Коши):

$$
\begin{cases}
v_{1}(0)=0 \\
v_{2}(0)=-2.031732629557337 \\
x(0)=0.994 \\
y(0)=0 \\
\end{cases}
$$

Параметры:

$$
\begin{gather}
m=0.012277471 \\
M=1-m=0.987722529 \\
T=11.124340337 \\
R_{1}=((x+m)^{2}+y^{2})^{3/2} \\
R_{2}=((x-M)^{2}+y^{2})^{3/2}
\end{gather}
$$

## Использование AVX для ускорения вычислений

Особое внимание уделено оптимизации метода Мерсона с помощью SIMD-инструкций AVX. Благодаря этому удалось добиться **почти четырёхкратного ускорения** расчётов!  
Реализация с AVX позволяет эффективно распараллеливать вычисления над массивами данных, что критично для задач с большим числом шагов интегрирования и высокой точностью.  
Если вам важно получить максимальную производительность на современных CPU — этот проект демонстрирует реальный прирост скорости при грамотном использовании AVX.

## Оценка ошибки метода Мерсона

Используется формула для локальной ошибки шага метода Мерсона:

$$
\varepsilon=\frac{1}{30}|-k_{1}+4k_{3}+k_{4}-k_{5}|
$$

Глобальная ошибка оценивается как накопление локальных ошибок, умноженных на шаг интегрирования $h$.

## Плотность вероятности столкновения

Для анализа вероятности столкновения спутников по их траекториям предложена следующая функция плотности:

$$
f_{Y}(y)=\frac{8}{(2+y)^{3}}, \quad \mathrm{E}(Y)=2
$$

График функции на $[0, 10]$:
<img width="799" height="499" alt="График плотности Y на [0,10]" src="https://github.com/user-attachments/assets/ee6f9960-3d05-4210-a44f-a202c9d2c6fc" />

Вероятность столкновения при разнице во времени $\Delta t$:

$$
\mathrm{P_{colission}}=\frac{8}{(2+\Delta t)^{3}}
$$

Рекуррентное вычисление вероятности:

$$
\begin{cases}
\mathrm{P}_{i+1}=(1-\mathrm{P}_{i})\cdot  \mathrm{P_{colission}} \\
\mathrm{P}_{0}=0
\end{cases}
$$

## Ключевые особенности и план развития

1. Изучение вычисления ошибки метода Мерсона (локальная $O(h^5)$, глобальная — $O(h^4)$), реализация теоретических оценок и ричардсон-экстраполяции.
2. Визуализация траекторий и результатов с помощью `matplotlibcpp.h`.
3. Оптимизация метода Мерсона с использованием SIMD (`avx`) — **почти 4-кратный прирост скорости**!
4. Переписать задачу в виде классов для удобной работы с несколькими объектами.
5. Реализация адаптивного шага интегрирования с учётом оценки ошибки.
6. Поддержка моделирования движения нескольких объектов.
7. Логика расчёта столкновений между объектами.

## Особенности численного моделирования

- Уравнения обладают **экстремальной чувствительностью** к начальному условию: погрешность в $10^{-7}$ может разрушить орбиту.
- Для оценки столкновений используется радиус $10^{-5}$.
- Для поиска ближайших значений времени в траектории применяется быстрый алгоритм поиска по ключу в `std::map`.

## Проблемы и замечания

- При вычислении расстояния между точками не следует брать квадратный корень — это может приводить к сингулярности.
- Функция $\frac{1}{1+x}$ удобна, но не является корректной плотностью вероятности (несобственна).
- Функция $f_{Y}(y)$ удобна для моделирования, обладает хорошими свойствами для вычисления матожидания.

---

**Репозиторий предназначен для численного моделирования, визуализации и анализа орбитальных задач с высокой точностью, высокой производительностью (благодаря AVX!) и возможностью масштабирования на несколько объектов.**
